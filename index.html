<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수강신청 시스템 데모</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Noto Sans KR 폰트 적용 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        /* 스크롤바 디자인 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* 토스트 메시지 애니메이션 */
        .toast {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
            transform: translateY(20px);
        }
        .toast.show {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <!-- 헤더 -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-600">수강신청 시스템</h1>
            <p class="text-gray-600 mt-2">원하는 강의를 신청해보세요. (데모 버전)</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 1. 개설 강좌 목록 -->
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">개설 강좌 목록</h2>
                <div id="course-list" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                    <!-- 자바스크립트로 강의 목록이 여기에 렌더링됩니다. -->
                </div>
            </div>

            <!-- 2. 수강 바구니 및 신청 내역 -->
            <div class="space-y-8">
                <!-- 수강 바구니 -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 border-b pb-2">수강 바구니</h2>
                    <div id="cart-list" class="space-y-3 mb-4 min-h-[100px]">
                        <!-- 자바스크립트로 장바구니 목록이 여기에 렌더링됩니다. -->
                    </div>
                    <button id="register-button" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400">
                        선택한 과목 일괄 신청
                    </button>
                </div>

                <!-- 나의 수강 내역 -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold mb-4 border-b pb-2">나의 수강 내역</h2>
                    <div id="registered-list" class="space-y-3 min-h-[100px]">
                         <!-- 자바스크립트로 신청 완료 목록이 여기에 렌더링됩니다. -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 토스트 메시지 -->
    <div id="toast" class="toast fixed bottom-5 right-5 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-xl">
        <p id="toast-message"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 데이터 (실제로는 서버에서 가져옴) ---
            const initialCourses = [
                { id: 1, name: '웹 프로그래밍 기초', professor: '김현수', time: '월 1-2교시', capacity: 30, enrolled: 28, credits: 3 },
                { id: 2, name: '자료구조와 알고리즘', professor: '이영희', time: '화 3-4교시', capacity: 25, enrolled: 10, credits: 3 },
                { id: 3, name: '데이터베이스 시스템', professor: '박철민', time: '수 5-6교시', capacity: 40, enrolled: 40, credits: 3 },
                { id: 4, name: '컴퓨터 네트워크', professor: '최지아', time: '목 1-2교시', capacity: 35, enrolled: 30, credits: 3 },
                { id: 5, name: '운영체제', professor: '정성훈', time: '금 3-4교시', capacity: 2, enrolled: 0, credits: 3 },
                { id: 6, name: '인공지능 입문', professor: '윤다솜', time: '화 3-4교시', capacity: 50, enrolled: 45, credits: 3 },
                { id: 7, name: '객체지향 프로그래밍', professor: '강민준', time: '월 5-6교시', capacity: 30, enrolled: 15, credits: 3 },
            ];

            // --- 상태 변수 ---
            let courses = JSON.parse(JSON.stringify(initialCourses)); // 원본 데이터 수정을 위한 깊은 복사
            let cart = [];
            let registeredCourses = [];

            // --- DOM 요소 ---
            const courseListEl = document.getElementById('course-list');
            const cartListEl = document.getElementById('cart-list');
            const registeredListEl = document.getElementById('registered-list');
            const registerButton = document.getElementById('register-button');
            const toastEl = document.getElementById('toast');
            const toastMessageEl = document.getElementById('toast-message');

            // --- 렌더링 함수 ---

            // 1. 개설 강좌 목록 렌더링
            const renderCourses = () => {
                courseListEl.innerHTML = '';
                courses.forEach(course => {
                    const isFull = course.enrolled >= course.capacity;
                    const isInCart = cart.some(item => item.id === course.id);
                    const isRegistered = registeredCourses.some(item => item.id === course.id);
                    
                    let buttonHtml;
                    if (isRegistered) {
                        buttonHtml = `<button class="w-full sm:w-auto px-4 py-2 rounded-md bg-green-600 text-white text-sm font-semibold" disabled>신청 완료</button>`;
                    } else if (isFull) {
                        buttonHtml = `<button class="w-full sm:w-auto px-4 py-2 rounded-md bg-red-500 text-white text-sm font-semibold" disabled>정원 초과</button>`;
                    } else if (isInCart) {
                        buttonHtml = `<button class="w-full sm:w-auto px-4 py-2 rounded-md bg-gray-400 text-white text-sm font-semibold" disabled>바구니에 있음</button>`;
                    } else {
                        buttonHtml = `<button onclick="addToCart(${course.id})" class="w-full sm:w-auto px-4 py-2 rounded-md bg-indigo-600 text-white text-sm font-semibold hover:bg-indigo-700 transition">바구니 담기</button>`;
                    }

                    const courseCard = `
                        <div class="border p-4 rounded-lg shadow-sm flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 ${isFull ? 'bg-red-50' : ''}">
                            <div>
                                <h3 class="font-bold text-lg">${course.name} <span class="text-sm font-medium text-gray-600">(${course.credits}학점)</span></h3>
                                <p class="text-sm text-gray-600">담당교수: ${course.professor} | 시간: ${course.time}</p>
                                <p class="text-sm font-semibold mt-1">
                                    신청 현황: <span class="${isFull ? 'text-red-600' : 'text-blue-600'}">${course.enrolled} / ${course.capacity}</span>
                                </p>
                            </div>
                            <div class="w-full sm:w-auto flex-shrink-0">
                                ${buttonHtml}
                            </div>
                        </div>
                    `;
                    courseListEl.innerHTML += courseCard;
                });
            };

            // 2. 수강 바구니 렌더링
            const renderCart = () => {
                cartListEl.innerHTML = '';
                if (cart.length === 0) {
                    cartListEl.innerHTML = '<p class="text-center text-gray-500 py-4">담은 강의가 없습니다.</p>';
                    registerButton.disabled = true;
                } else {
                    cart.forEach(course => {
                        const cartItem = `
                            <div class="flex justify-between items-center bg-gray-100 p-2 rounded-md">
                                <div>
                                    <p class="font-semibold">${course.name}</p>
                                    <p class="text-xs text-gray-500">${course.time}</p>
                                </div>
                                <button onclick="removeFromCart(${course.id})" class="text-red-500 hover:text-red-700 font-bold text-lg">&times;</button>
                            </div>
                        `;
                        cartListEl.innerHTML += cartItem;
                    });
                    registerButton.disabled = false;
                }
            };
            
            // 3. 나의 수강 내역 렌더링
            const renderRegistered = () => {
                registeredListEl.innerHTML = '';
                 if (registeredCourses.length === 0) {
                    registeredListEl.innerHTML = '<p class="text-center text-gray-500 py-4">신청한 강의가 없습니다.</p>';
                } else {
                    registeredCourses.forEach(course => {
                        const registeredItem = `
                            <div class="bg-green-100 p-3 rounded-md">
                                <p class="font-semibold text-green-800">${course.name}</p>
                                <p class="text-xs text-green-700">${course.professor} / ${course.time}</p>
                            </div>
                        `;
                        registeredListEl.innerHTML += registeredItem;
                    });
                }
            }

            // --- 이벤트 핸들러 및 로직 ---

            // 토스트 메시지 표시
            const showToast = (message, type = 'success') => {
                toastMessageEl.textContent = message;
                toastEl.className = 'toast show fixed bottom-5 right-5 text-white px-6 py-3 rounded-lg shadow-xl'; // Reset classes
                if (type === 'error') {
                    toastEl.classList.add('bg-red-600');
                } else {
                    toastEl.classList.add('bg-gray-800');
                }
                
                setTimeout(() => {
                    toastEl.className = toastEl.className.replace('show', '');
                }, 3000);
            };

            // 바구니에 담기
            window.addToCart = (courseId) => {
                const course = courses.find(c => c.id === courseId);
                
                // 시간표 중복 체크
                const timeConflict = cart.some(item => item.time === course.time);
                if (timeConflict) {
                    showToast('선택한 강의와 시간이 겹칩니다.', 'error');
                    return;
                }

                // 등록된 강의와 시간표 중복 체크
                const registeredTimeConflict = registeredCourses.some(item => item.time === course.time);
                 if (registeredTimeConflict) {
                    showToast('이미 신청한 강의와 시간이 겹칩니다.', 'error');
                    return;
                }

                cart.push(course);
                updateAll();
            };

            // 바구니에서 삭제
            window.removeFromCart = (courseId) => {
                cart = cart.filter(item => item.id !== courseId);
                updateAll();
            };

            // 수강신청 처리
            registerButton.addEventListener('click', () => {
                if (cart.length === 0) return;

                let successCount = 0;
                let failCount = 0;
                let failedCourses = [];

                cart.forEach(cartItem => {
                    const courseInDb = courses.find(c => c.id === cartItem.id);
                    
                    // 동시성 문제 시뮬레이션: 10% 확률로 다른 사람이 먼저 신청했다고 가정
                    const someoneElseWasFaster = Math.random() < 0.1;

                    if (courseInDb.enrolled < courseInDb.capacity && !someoneElseWasFaster) {
                        courseInDb.enrolled++;
                        registeredCourses.push(courseInDb);
                        successCount++;
                    } else {
                        failCount++;
                        failedCourses.push(courseInDb.name);
                    }
                });

                cart = []; // 바구니 비우기
                
                if (failCount > 0) {
                     showToast(`${failedCourses.join(', ')} 신청 실패 (정원 초과 또는 동시 신청).`, 'error');
                }
                if (successCount > 0) {
                    showToast(`${successCount}개 강의 신청 성공!`, 'success');
                }

                updateAll();
            });

            // --- 초기화 및 전체 업데이트 ---
            const updateAll = () => {
                renderCourses();
                renderCart();
                renderRegistered();
            };

            // 앱 시작
            updateAll();
        });
    </script>
</body>
</html>
